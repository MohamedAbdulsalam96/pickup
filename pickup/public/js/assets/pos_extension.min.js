!function(){"use strict";erpnext.pos.PointOfSale=erpnext.pos.PointOfSale.extend({make_customer:function(t){this._super(t),this.list_customers_btn=this.page.wrapper.find(".list-customers-btn"),this.list_customers_btn.after($('<button class="btn btn-default get-orders-btn" style="margin-left: 12px"><i class="octicon octicon-gift"></i></button>')),this.get_customer_orders()},get_customer_orders:function(t){var o=this;this.get_orders_btn=this.page.wrapper.find(".get-orders-btn"),this.page.wrapper.on("click",".get-orders-btn",function(t){o.customer_validate(),frappe.call({method:"pickup.pickup.doctype.pickup_slot.pickup_slot.get_items_from_sales_order",args:{customer:o.frm.doc.customer,pickup_slot:o.pos_profile_data.pickup_slot},callback:function(t){(t.message||[]).forEach(function(t){o.items=o.get_items(t.item_code),o.add_to_cart(),1!=t.qty&&o.update_qty(t.item_code,t.qty),o.child.uom=t.uom,o.child.conversion_factor=t.conversion_factor,o.set_item_details(t.item_code,"rate",t.rate),o.update_value()})}})})}}),erpnext.taxes_and_totals.prototype.calculate_outstanding_amount=function(t){if("Sales Invoice"==this.frm.doc.doctype&&this.frm.doc.is_return&&this.calculate_paid_amount(),!(this.frm.doc.is_return||this.frm.doc.docstatus>0)&&(frappe.model.round_floats_in(this.frm.doc,["grand_total","total_advance","write_off_amount"]),in_list(["Sales Invoice","Purchase Invoice"],this.frm.doc.doctype))){var o=this.frm.doc.rounded_total||this.frm.doc.grand_total;if(this.frm.doc.party_account_currency==this.frm.doc.currency)var a=flt(o-this.frm.doc.total_advance-this.frm.doc.write_off_amount+this.frm.doc.balance_amount,precision("grand_total"));else a=flt(flt(o*this.frm.doc.conversion_rate,precision("grand_total"))-this.frm.doc.total_advance-this.frm.doc.base_write_off_amount+this.frm.doc.balance_amount,precision("base_grand_total"));frappe.model.round_floats_in(this.frm.doc,["paid_amount"]),this.set_in_company_currency(this.frm.doc,["paid_amount"]),this.frm.refresh_field&&(this.frm.refresh_field("paid_amount"),this.frm.refresh_field("base_paid_amount")),"Sales Invoice"==this.frm.doc.doctype&&(this.set_default_payment(a,t),this.calculate_paid_amount()),this.calculate_change_amount();var e=this.frm.doc.party_account_currency==this.frm.doc.currency?this.frm.doc.paid_amount:this.frm.doc.base_paid_amount;this.frm.doc.outstanding_amount=flt(a-flt(e)+flt(this.frm.doc.change_amount*this.frm.doc.conversion_rate),precision("outstanding_amount"))}},erpnext.taxes_and_totals.prototype.calculate_change_amount=function(){if(this.frm.doc.change_amount=0,this.frm.doc.base_change_amount=0,"Sales Invoice"==this.frm.doc.doctype&&this.frm.doc.paid_amount>this.frm.doc.grand_total+this.frm.doc.balance_amount&&!this.frm.doc.is_return){var t=$.map(this.frm.doc.payments,function(t){return t.type});if(in_list(t,"Cash")){var o=this.frm.doc.rounded_total||this.frm.doc.grand_total,a=this.frm.doc.base_rounded_total||this.frm.doc.base_grand_total;this.frm.doc.change_amount=flt(this.frm.doc.paid_amount-o+this.frm.doc.write_off_amount-this.frm.doc.balance_amount,precision("change_amount")),this.frm.doc.base_change_amount=flt(this.frm.doc.base_paid_amount-a+this.frm.doc.base_write_off_amount-this.frm.doc.balance_amount,precision("base_change_amount"))}}},erpnext.taxes_and_totals.prototype.calculate_write_off_amount=function(){this.frm.doc.paid_amount>this.frm.doc.grand_total?(this.frm.doc.write_off_amount=flt(this.frm.doc.grand_total-this.frm.doc.paid_amount+this.frm.doc.change_amount+this.frm.doc.balance_amount,precision("write_off_amount")),this.frm.doc.base_write_off_amount=flt(this.frm.doc.write_off_amount*this.frm.doc.conversion_rate,precision("base_write_off_amount"))):this.frm.doc.paid_amount=0,this.calculate_outstanding_amount(!1)},erpnext.payments.prototype.balance_amount=function(t){this.frm.doc.balance_amount=flt(t,precision("balance_amount")),this.calculate_outstanding_amount(!1),this.show_amounts()},erpnext.payments.prototype.get_customer_balance=function(t){var o=this;frappe.call({method:"pickup.pickup.custom_classes.pos.get_customer_balance",args:{customer:t},callback:function(t){var a=flt(t.message);a>0?$(o.$body).find("#customer-balance-label").text(__("Solde (Dû)")):$(o.$body).find("#customer-balance-label").text(__("Solde (Avoir)")),$(o.$body).find("#customer-balance").text(format_currency(a,o.frm.doc.currency)).val(a)}})},erpnext.payments.prototype.set_payment_primary_action=function(){var t=this;this.dialog.set_primary_action(__("Submit"),function(){t.dialog.hide(),t.submit_invoice()})},erpnext.payments.prototype.show_payment_details=function(){var t=this,o=$(this.$body).find(".multimode-payments").empty();this.frm.doc.payments.length?$.each(this.frm.doc.payments,function(a,e){$(frappe.render_template("payment_details",{mode_of_payment:e.mode_of_payment,amount:e.amount,idx:e.idx,currency:t.frm.doc.currency,type:e.type})).appendTo(o),"Cash"==e.type&&e.amount==t.frm.doc.paid_amount&&(t.idx=e.idx,t.selected_mode=$(t.$body).find(repl("input[idx='%(idx)s']",{idx:t.idx})),t.highlight_selected_row(),t.bind_amount_change_event())}):$("<p>No payment mode selected in pos profile</p>").appendTo(o),t.get_customer_balance(t.frm.doc.customer)},erpnext.payments.prototype.set_outstanding_amount=function(){this.selected_mode=$(this.$body).find(repl("input[idx='%(idx)s']",{idx:this.idx})),this.highlight_selected_row(),this.payment_val=0,this.frm.doc.outstanding_amount>0&&0==flt(this.selected_mode.val())?(this.payment_val=flt(this.frm.doc.outstanding_amount/this.frm.doc.conversion_rate,precision("outstanding_amount")),"balance_amount"==this.idx?this.selected_mode.val(format_currency($(this.$body).find("#customer-balance").val(),this.frm.doc.currency)):(this.selected_mode.val(format_currency(this.payment_val,this.frm.doc.currency)),this.update_payment_amount())):flt(this.selected_mode.val())>0&&(this.payment_val=flt(this.selected_mode.val())),this.selected_mode.select(),this.bind_amount_change_event()},erpnext.payments.prototype.bind_form_control_event=function(){var t=this;$(this.$body).find(".pos-payment-row").click(function(){t.idx=$(this).attr("idx"),t.set_outstanding_amount()}),$(this.$body).find(".form-control").click(function(){t.idx=$(this).attr("idx"),t.set_outstanding_amount(),t.update_paid_amount(!0)}),$(this.$body).find(".write_off_amount").change(function(){t.write_off_amount(flt($(this).val()),precision("write_off_amount"))}),$(this.$body).find(".change_amount").change(function(){t.change_amount(flt($(this).val()),precision("change_amount"))}),$(this.$body).find(".balance_amount").change(function(){t.balance_amount(flt($(this).val()),precision("balance_amount"))})},erpnext.payments.prototype.update_paid_amount=function(t){var o=this;if(in_list(["change_amount","write_off_amount","balance_amount"],this.idx)){var a=o.selected_mode.val();"change_amount"==o.idx?o.change_amount(a):"write_off_amount"==o.idx?(0==flt(a)&&t&&o.frm.doc.outstanding_amount>0&&(a=flt(o.frm.doc.outstanding_amount/o.frm.doc.conversion_rate,precision(o.idx))),o.write_off_amount(a)):o.balance_amount(a)}else this.update_payment_amount()},erpnext.payments.prototype.show_amounts=function(){$(this.$body).find(".write_off_amount").val(format_currency(this.frm.doc.write_off_amount,this.frm.doc.currency)),$(this.$body).find(".paid_amount").text(format_currency(this.frm.doc.paid_amount,this.frm.doc.currency)),$(this.$body).find(".change_amount").val(format_currency(this.frm.doc.change_amount,this.frm.doc.currency)),$(this.$body).find(".outstanding_amount").text(format_currency(this.frm.doc.outstanding_amount,frappe.get_doc(":Company",this.frm.doc.company).default_currency)),$(this.$body).find(".balance_amount").val(format_currency(this.frm.doc.balance_amount,this.frm.doc.currency)),this.update_invoice()},frappe.templates.pos_payment='<div class="pos_payment row">  <div class="row" style="padding: 0px 30px;">   <h3>{{ __("Total Amount") }}: <span class="label label-default" style="font-size:20px;padding:5px">{%= format_currency(grand_total, currency) %}</span></h3>  </div>  <div class="row amount-row">   <div class="col-xs-6 col-sm-3 text-center">    <p class="amount-label"> {{ __("Paid") }} <h3 class="paid_amount">{%= format_currency(paid_amount, currency) %}</h3></p>   </div>   <div class="col-xs-6 col-sm-3 text-center">    <p class="amount-label"> {{ __("Outstanding") }} <h3 class="outstanding_amount">{%= format_currency(outstanding_amount, currency) %} </h3></p>   </div>   <div class="col-xs-6 col-sm-3 text-center">    <p class="amount-label"> {{ __("Change") }} <input class="form-control text-right change_amount bold" type="text" idx="change_amount" value="{{format_number(change_amount, null, 2)}}">    </p>   </div>   <div class="col-xs-6 col-sm-3 text-center">    <p class="amount-label"> {{ __("Write off") }} <input class="form-control text-right write_off_amount bold" type="text" idx="write_off_amount" value="{{format_number(write_off_amount, null, 2)}}">    </p>   </div>  </div>  <hr>  <div class="row">   <div class="col-sm-6 ">    <div class ="row multimode-payments">    </div>    <br><br>    <div class ="row" style="padding: 0px 50px;">     <p id="customer-balance-label" class="amount-label"></p>     <h3 id="customer-balance"></h3>     <p class="amount-label"> {{ __("Régularisation") }} <input class="form-control text-right balance_amount bold" type="text" idx="balance_amount" value="{{format_number(balance_amount, null, 2)}}"></p>    </div>   </div>   <div class="col-sm-6 payment-toolbar">    {% for(var i=0; i<3; i++) { %}     <div class="row">      {% for(var j=i*3; j<(i+1)*3; j++) { %}       <button type="button"  class="btn btn-default pos-keyboard-key">{{j+1}}</button>      {% } %}     </div>    {% } %}    <div class="row">     <button type="button"  class="btn btn-default delete-btn">{{ __("Del") }}</button>     <button type="button"  class="btn btn-default pos-keyboard-key">0</button>     <button type="button"  class="btn btn-default pos-keyboard-key">.</button>    </div>         </div>  </div> </div> '}();
//# sourceMappingURL=pos_extension.min.js.map
